<% provide(:title, 'Find Report') %>
<ul class="nav nav-tabs">
  <li><%= link_to "Ward List", ward_path %></li>
  <li><%= link_to "Investigators", investigators_path %></li>
  <li><%= link_to "Watch List", watch_path %></li>
  <li class="active"><%= link_to "Find Report", reports_path %></li>
  <li><%= link_to "Create Report", newactivity_path %></li>
  <li><%= link_to "Archive", archive_path %></li>
</ul>
<h1>Find Report</h1>
<div class="row">
  <div class="span2 dropdown">
    <a class="dropdown-toggle btn btn-medium btn-primary" data-toggle="dropdown" href="#">Find by date</a>
    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">
      <li><%= link_to "In the last week", reports_path(:activity_date => 1.week.ago) %></li>
      <li><%= link_to "In the last month", reports_path(:activity_date => 1.month.ago) %></li>
      <li><%= link_to "In the last quarter", reports_path(:activity_date => 3.months.ago) %></li>
      <li><%= link_to "In the last six months", reports_path(:activity_date => 6.months.ago) %></li>
      <li><%= link_to "In the last year", reports_path(:activity_date => 12.months.ago) %></li>
    </ul>
  </div>
  <div class="span2 dropdown">
    <a class="dropdown-toggle btn btn-medium btn-primary" data-toggle="dropdown" href="#">Find by family</a>
    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">
      <% Family.where("archived = ?", false).each do |family| %>
        <li><%= link_to family.name, reports_path(:family_id => family.id) %></li>
      <% end %>
    </ul>
  </div>
  <div class="span2">
    <%= link_to "Show All", reports_path, class: "btn btn-medium btn-secondary" %>
  </div>
  <div class="span2">
    <h5>Total Reports: <%= @activities.count %></h5>
  </div>
  <div class="span2">
    <h5>Total Visits: <%= @visit_count %></h5>
  </div>
</div>
<h4>&nbsp</h4>

<% if @selected_family %>
  <div class="row">
    <div class="span12" style="overflow: auto;">
      <table class="table table-condensed">
        <thead class="fourteenfifty">  
          <tr>
            <th class="twofifty">Family Name</th>  
            <th class="hundredfifty">Family Phone</th>  
            <th class="twofifty">Family Email</th>
            <th class="twofifty">Family Address</th>
            <th class="twofifty">Child Names</th>
            <th class="hundred">Member?</th>
          </tr>
        </thead>
        <tbody class="fiftyhigh fourteenfifty">
          <tr>
            <td class="twofifty"><%= link_to @selected_family.name, edit_family_path(@selected_family) %></td>
            <td class="hundredfifty"><%= @selected_family.phone %></td>
            <td class="twofifty"><%= @selected_family.email %></td>
            <td class="twofifty"><%= @selected_family.address %></td>
            <td class="twofifty"><%= @selected_family.children %></td>
            <td class="hundred">
              <% if @selected_family.investigator %>
                False
              <% else %>
                True
              <% end %>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
<% elsif @report_date %>
  <center><h3>
    <% if @report_date < 12.months.ago %>
      Annual Report
    <% elsif @report_date < 6.months.ago %>
      Semi-Annual Report
    <% elsif @report_date < 3.months.ago %>
      Quarterly Report
    <% elsif @report_date < 1.month.ago %>
      Monthly Report
    <% elsif @report_date < 1.week.ago %>
      Weekly Report
    <% end %>
  </h3></center>
<% else %>
  <center><h3>All Activity</h3></center>
<% end %>

<% if @activities && @activities.count > 0 %>
  <div class="row">
    <div class="span12" style="overflow: auto;">
      <table class="table table-condensed table-hover">
        <% if @selected_family %>
          <thead class="twelvehundred">  
            <tr>  
              <th class="hundred">Visited?</th>
              <th class="hundred">Date</th>
              <th class="fivehundred">Notes</th>
              <th class="twofifty">Reported By</th>
              <th class="twofifty">Input By</th>
            </tr>  
          </thead>
          <tbody class="twelvehundred"> 
            <%= render @activities %>
          </tbody>
        <% else %>
          <thead class="fourteenfifty">  
            <tr>  
              <th class="twofifty">Family Name</th>  
              <th class="hundred">Visited?</th>
              <th class="hundred">Date</th>
              <th class="fivehundred">Notes</th>
              <th class="twofifty">Reported By</th>
              <th class="twofifty">Input By</th>  
            </tr>  
          </thead>
          <tbody class="fourteenfifty"> 
            <%= render @activities %>
          </tbody>
        <% end %>
      </table>
    </div>
  </div>
<% else %>
  <h3>No activity reported</h3>
<% end %>
